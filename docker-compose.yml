services:

  mongo:
    image: mongo:7
    ports: ["27017:27017"]
    command: ["--bind_ip_all"]

  rabbitmq:
    image: rabbitmq:3-management
    ports: ["5672:5672","15672:15672"]

  # âœ… Public echo server that works without auth
  ros-vendor:
    build: ./scripts/ros-vendor-stub
    ports: ["5678:5678"]

  wms-sim:
    image: alpine/socat
    command: -d -d tcp-listen:7001,fork,reuseaddr system:"cat"
    ports: ["7001:7001"]

  cms-adapter:
    build: ./infrastructure/adapters/cms-adapter
    ports: ["3001:3001"]
    environment:
      RABBIT_URL: amqp://rabbitmq
      ORDERS_EX: orders
    depends_on: [rabbitmq]

  ros-adapter:
    build: ./infrastructure/adapters/ros-adapter
    ports: ["3002:3002"]
    environment:
      RABBIT_URL: amqp://rabbitmq
      ORDERS_EX: orders
      ROUTES_EX: routes
      VENDOR_URL: http://ros-vendor:5678/route
      MONGO_URL: mongodb://mongo:27017
      DB_NAME: swift
    depends_on: [rabbitmq, mongo, ros-vendor]

  wms-adapter:
    build: ./infrastructure/adapters/wms-adapter
    ports: ["3003:3003"]
    environment:
      RABBIT_URL: amqp://rabbitmq
      ROUTES_EX: routes
      WMS_HOST: wms-sim
      WMS_PORT: 7001
    depends_on: [rabbitmq, wms-sim]

  
  gateway:
    build:
      context: ./infrastructure/adapters/gateway
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      CMS_URL: http://cms-adapter:3001/orders
    depends_on:
      - cms-adapter


